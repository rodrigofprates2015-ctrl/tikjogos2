2025-11-30T04:40:53.000000000Z [inf]  Starting Container
2025-11-30T04:40:54.406532364Z [err]  npm warn config production Use `--omit=dev` instead.
2025-11-30T04:40:54.406537231Z [inf]  
2025-11-30T04:40:54.406541645Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:40:54.406545510Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:40:54.406550515Z [inf]  
2025-11-30T04:40:54.406554939Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:40:54.406559313Z [err]  designed for a production environment, as it will leak
2025-11-30T04:40:54.406563136Z [err]  memory, and will not scale past a single process.
2025-11-30T04:40:54.406569078Z [err]  /app/dist/index.cjs:85
2025-11-30T04:40:55.614981064Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:40:55.614988538Z [inf]  
2025-11-30T04:40:55.614995227Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:40:55.615002136Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:40:55.615008656Z [inf]  
2025-11-30T04:40:55.615015207Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:40:55.615021227Z [err]  designed for a production environment, as it will leak
2025-11-30T04:40:55.615029939Z [err]  memory, and will not scale past a single process.
2025-11-30T04:40:55.615036958Z [err]  /app/dist/index.cjs:85
2025-11-30T04:40:56.582485163Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:40:56.582492785Z [inf]  
2025-11-30T04:40:56.582499114Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:40:56.582508755Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:40:56.582515470Z [inf]  
2025-11-30T04:40:56.662190568Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:40:56.662196016Z [err]  designed for a production environment, as it will leak
2025-11-30T04:40:56.662200134Z [err]  memory, and will not scale past a single process.
2025-11-30T04:40:56.662204248Z [err]  /app/dist/index.cjs:85
2025-11-30T04:40:57.809991871Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:40:57.844850995Z [inf]  
2025-11-30T04:40:57.844858045Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:40:57.844862914Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:40:57.844869368Z [inf]  
2025-11-30T04:40:58.009199498Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:40:58.009206954Z [err]  designed for a production environment, as it will leak
2025-11-30T04:40:58.009211148Z [err]  memory, and will not scale past a single process.
2025-11-30T04:40:58.009215930Z [err]  /app/dist/index.cjs:85
2025-11-30T04:40:59.620210945Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:40:59.620216207Z [inf]  
2025-11-30T04:40:59.620221318Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:40:59.620226069Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:40:59.620229837Z [inf]  
2025-11-30T04:40:59.620233795Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:40:59.620237770Z [err]  designed for a production environment, as it will leak
2025-11-30T04:40:59.620242522Z [err]  memory, and will not scale past a single process.
2025-11-30T04:40:59.620246889Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:00.660422957Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:41:00.660430794Z [inf]  
2025-11-30T04:41:00.660438564Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:41:00.660447617Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:41:00.660454887Z [inf]  
2025-11-30T04:41:00.797626861Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:41:00.797633694Z [err]  designed for a production environment, as it will leak
2025-11-30T04:41:00.797638842Z [err]  memory, and will not scale past a single process.
2025-11-30T04:41:00.797643295Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:01.796109742Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:41:01.818363566Z [inf]  
2025-11-30T04:41:01.818370355Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:41:01.818375401Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:41:01.818379728Z [inf]  
2025-11-30T04:41:01.960484681Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:41:01.960493785Z [err]  designed for a production environment, as it will leak
2025-11-30T04:41:01.960498594Z [err]  memory, and will not scale past a single process.
2025-11-30T04:41:01.963000332Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:03.036153195Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:41:03.036157952Z [inf]  
2025-11-30T04:41:03.036161834Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:41:03.036166012Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:41:03.036170282Z [inf]  
2025-11-30T04:41:03.795641570Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:03.795682544Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:41:03.795695835Z [err]  designed for a production environment, as it will leak
2025-11-30T04:41:03.795699900Z [err]  memory, and will not scale past a single process.
2025-11-30T04:41:04.633072521Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:41:04.633079992Z [inf]  
2025-11-30T04:41:04.633088353Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:41:04.633094781Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:41:04.633102020Z [inf]  
2025-11-30T04:41:04.633110068Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:41:04.633116752Z [err]  designed for a production environment, as it will leak
2025-11-30T04:41:04.633123167Z [err]  memory, and will not scale past a single process.
2025-11-30T04:41:04.633129213Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:05.641686622Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:41:05.641690963Z [inf]  
2025-11-30T04:41:05.641694681Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:41:05.641699800Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:41:05.641703522Z [inf]  
2025-11-30T04:41:05.769481033Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:41:05.769488342Z [err]  designed for a production environment, as it will leak
2025-11-30T04:41:05.769495842Z [err]  memory, and will not scale past a single process.
2025-11-30T04:41:05.769501814Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:06.968191969Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:41:06.995029927Z [inf]  
2025-11-30T04:41:06.995040685Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:41:06.995048432Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:41:06.995056136Z [inf]  
2025-11-30T04:41:07.125783518Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:41:07.125796551Z [err]  designed for a production environment, as it will leak
2025-11-30T04:41:07.125803416Z [err]  memory, and will not scale past a single process.
2025-11-30T04:41:07.125836314Z [err]  /app/dist/index.cjs:85
2025-11-30T04:41:38.018407542Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thi
2025-11-30T04:44:48.742093154Z [err]  npm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:48.742099555Z [inf]  
2025-11-30T04:44:48.742104573Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:48.742108933Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:48.742113666Z [inf]  
2025-11-30T04:44:48.742118550Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:48.742123668Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:48.742128593Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:48.742133352Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:48.795452907Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:48.825858668Z [inf]  
2025-11-30T04:44:48.825867350Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:48.825878542Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:48.825886194Z [inf]  
2025-11-30T04:44:48.998632742Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:48.998639923Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:48.998645012Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:48.998649555Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:51.109245789Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:51.115516687Z [inf]  
2025-11-30T04:44:51.115523440Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:51.115528978Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:51.115533826Z [inf]  
2025-11-30T04:44:51.719597901Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:51.719627991Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:51.719637612Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:51.719644457Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:52.846896403Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:52.846902830Z [inf]  
2025-11-30T04:44:52.846908575Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:52.846913550Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:52.846918521Z [inf]  
2025-11-30T04:44:52.846922787Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:52.846927960Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:52.846933489Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:52.846938629Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:53.910937845Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:53.938290878Z [inf]  
2025-11-30T04:44:53.938295357Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:53.938300506Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:53.938304579Z [inf]  
2025-11-30T04:44:54.066480298Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:54.066491335Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:54.066496947Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:54.066504467Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:56.865924519Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:56.865929335Z [inf]  
2025-11-30T04:44:56.865933785Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:56.865940224Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:56.865945519Z [inf]  
2025-11-30T04:44:56.865950095Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:56.865954412Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:56.865958921Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:56.865963870Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:57.882794494Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:57.882800205Z [inf]  
2025-11-30T04:44:57.882804437Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:57.882830439Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:57.882835676Z [inf]  
2025-11-30T04:44:57.882840946Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:57.882846605Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:57.882851861Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:57.882856468Z [err]  /app/dist/index.cjs:85
2025-11-30T04:44:59.887062715Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:44:59.887069090Z [inf]  
2025-11-30T04:44:59.887075868Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:44:59.887083021Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:44:59.887089782Z [inf]  
2025-11-30T04:44:59.887097351Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:44:59.887104853Z [err]  designed for a production environment, as it will leak
2025-11-30T04:44:59.887120165Z [err]  memory, and will not scale past a single process.
2025-11-30T04:44:59.887128599Z [err]  /app/dist/index.cjs:85
2025-11-30T04:45:00.841192352Z [err]  memory, and will not scale past a single process.
2025-11-30T04:45:00.841280455Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:45:00.841287054Z [inf]  
2025-11-30T04:45:00.841293516Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:45:00.841299416Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:45:00.841305561Z [inf]  
2025-11-30T04:45:00.841640652Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:45:00.841644849Z [err]  designed for a production environment, as it will leak
2025-11-30T04:45:00.846839868Z [err]  /app/dist/index.cjs:85
2025-11-30T04:45:01.921356805Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:45:01.946617802Z [inf]  
2025-11-30T04:45:01.946625337Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:45:01.946629663Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:45:01.946634051Z [inf]  
2025-11-30T04:45:02.075397367Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:45:02.075407620Z [err]  designed for a production environment, as it will leak
2025-11-30T04:45:02.075413282Z [err]  memory, and will not scale past a single process.
2025-11-30T04:45:02.080796159Z [err]  /app/dist/index.cjs:85
2025-11-30T04:45:03.282502446Z [err]  `);c.write(s.format.apply(s,E))}}b(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:b(function(){return o},"get"),set:b(function(R){o=R},"set")}),e.exports.warnTo=function(R){var E=c;return c=R,E},e.exports.getFileName=function(R){var E=R||le.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(R,E){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(w('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(R,E){return m.slice(0,-1).reduce(function(A,P,k){return k==1&&Number(R[P]||a)===Number(E[P])?A&&!0:A&&(E[P]==="*"||E[P]===R[P])},!0)};e.exports.getPassword=function(R,E,A){var P,k=E.pipe(i());function M(Q){var q=_(Q);q&&N(q)&&S(R,q)&&(P=q[y],k.end())}b(M,"onLine");var j=b(function(){E.destroy(),A(P)},"onEnd"),G=b(function(Q){E.destroy(),w("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",G),k.on("data",M).on("end",j).on("error",G)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var E="",A="",P=0,k=0,M=0,j={},G=!1,Q=b(function(U,J,te){var fe=R.substring(J,te);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(fe=fe.replace(/\\([:\\])/g,"$1")),j[m[U]]=fe},"addToObj"),q=0;q<R.length-1;q+=1){if(E=R.charAt(q+1),A=R.charAt(q),G=P==p-1,G){Q(P,k);break}q>=0&&E==":"&&A!=="\\"&&(Q(P,k,q+1),k=q+2,P+=1)}return j=Object.keys(j).length===p?j:null,j},N=e.exports.isValidEntry=function(R){for(var E={0:function(j){return j.length>0},1:function(j){return j==="*"?!0:(j=Number(j),isFinite(j)&&j>0&&j<9007199254740992&&Math.floor(j)===j)},2:function(j){return j.length>0},3:function(j){return j.length>0},4:function(j){return j.length>0}},A=0;A<m.length;A+=1){var P=E[A],k=R[m[A]]||"",M=P(k);if(!M)return!1}return!0}}),TM=pe((t,e)=>{"use strict";ee();var r=(vE(),ot(Qh)),n=(yE(),ot(Gh)),i=CM();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return a(void 0);var l=n.createReadStream(o);i.getPassword(s,l,a)})},e.exports.warnTo=i.warnTo}),Hh=pe((t,e)=>{"use strict";ee();var r=Ru();function n(i){this._types=i||r,this.text={},this.binary={}}b(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),SE={};pr(SE,{default:()=>EE});var EE,AM=jt(()=>{"use strict";ee(),EE={}}),kE={};pr(kE,{parse:()=>Wh});function Wh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,searchParams:f,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),u=decodeURIComponent(u);let v=i+":"+s,m=e?Object.fromEntries(f.entries()):l;return{href:t,protocol:r,auth:v,username:i,password:s,host:a,hostname:o,port:c,pathname:u,search:l,query:m,hash:d}}var CE=jt(()=>{"use strict";ee(),b(Wh,"parse")}),PM=pe((t,e)=>{"use strict";ee();var r=(CE(),ot(kE)),n=(yE(),ot(Gh));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(a.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var l=a.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var f=l.split("/");o.host=decodeURIComponent(f[0]),l=f.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}b(i,"parse"),e.exports=i,i.parse=i}),Kh=pe((t,e)=>{"use strict";ee();var r=(AM(),ot(SE)),n=Lu(),i=PM().parse,s=b(function(f,d,v){return v===void 0?v=le.env["PG"+f.toUpperCase()]:v===!1||(v=le.env[v]),d[f]||v||n[f]},"val"),a=b(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=b(function(f){return"'"+(""+f).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=b(function(f,d,v){var m=d[v];m!=null&&f.push(v+"="+o(m))},"add"),u=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var v=[];c(v,this,"user"),c(v,this,"password"),c(v,this,"port"),c(v,this,"application_name"),c(v,this,"fallback_application_name"),c(v,this,"connect_timeout"),c(v,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(v,m,"sslmode"),c(v,m,"sslca"),c(v,m,"sslkey"),c(v,m,"sslcert"),c(v,m,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return d(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(p,y){return p?d(p,null):(v.push("hostaddr="+o(y)),d(null,v.join(" ")))})}};b(u,"ConnectionParameters");var l=u;e.exports=l}),IM=pe((t,e)=>{"use strict";ee();var r=Ru(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var f=o[u];f!==null?c[u]=this._parsers[u](f):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var f=o[u],d=this.fields[u].name;f!==null?c[d]=this._parsers[u](f):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};b(i,"Result");var s=i;e.exports=s}),OM=pe((t,e)=>{"use strict";ee();var{EventEmitter:r}=ai(),n=IM(),i=qu(),s=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,le.domain&&c.callback&&(this.callback=le.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){le.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};b(s,"Query");var a=s;e.exports=a}),TE={};pr(TE,{Socket:()=>mn,isIP:()=>AE});function AE(t){return 0}var nE,Bh,no,mn,Zh=jt(()=>{"use strict";ee(),nE=gs(ai(),1),b(AE,"isIP"),Bh=/^[^.]+\./,no=class ne extends nE.EventEmitter{constructor(){super(...arguments),ae(this,"opts",{}),ae(this,"connecting",!1),ae(this,"pending",!0),ae(this,"writable",!0),ae(this,"encrypted",!1),ae(this,"authorized",!1),ae(this,"destroyed",!1),ae(this,"ws",null),ae(this,"writeBuffer"),ae(this,"tlsState",0),ae(this,"tlsRead"),ae(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=b(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=b((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=se.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=se.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=se.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=se.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},b(no,"Socket"),ae(no,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:b((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(Bh,"apiauth."):n=t.replace(Bh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:b(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ae(no,"opts",{}),mn=no}),PE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(q,U,J){super(q),this.length=U,this.name=J}};b(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(q,U){this.length=q,this.chunk=U,this.name="copyData"}};b(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(q,U,J,te){this.length=q,this.name=U,this.binary=J,this.columnTypes=new Array(te)}};b(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(q,U,J,te,fe,he,Le){this.name=q,this.tableID=U,this.columnID=J,this.dataTypeID=te,this.dataTypeSize=fe,this.dataTypeModifier=he,this.format=Le}};b(o,"Field");var c=o;t.Field=c;var u=class{constructor(q,U){this.length=q,this.fieldCount=U,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};b(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var f=class{constructor(q,U){this.length=q,this.parameterCount=U,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};b(f,"ParameterDescriptionMessage");var d=f;t.ParameterDescriptionMessage=d;var v=class{constructor(q,U,J){this.length=q,this.parameterName=U,this.parameterValue=J,this.name="parameterStatus"}};b(v,"ParameterStatusMessage");var m=v;t.ParameterStatusMessage=m;var p=class{constructor(q,U){this.length=q,this.salt=U,this.name="authenticationMD5Password"}};b(p,"AuthenticationMD5Password");var y=p;t.AuthenticationMD5Password=y;var w=class{constructor(q,U,J){this.length=q,this.processID=U,this.secretKey=J,this.name="backendKeyData"}};b(w,"BackendKeyDataMessage");var S=w;t.BackendKeyDataMessage=S;var _=class{constructor(q,U,J,te){this.length=q,this.processId=U,this.channel=J,this.payload=te,this.name="notification"}};b(_,"NotificationResponseMessage");var N=_;t.NotificationResponseMessage=N;var R=class{constructor(q,U){this.length=q,this.status=U,this.name="readyForQuery"}};b(R,"ReadyForQueryMessage");var E=R;t.ReadyForQueryMessage=E;var A=class{constructor(q,U){this.length=q,this.text=U,this.name="commandComplete"}};b(A,"CommandCompleteMessage");var P=A;t.CommandCompleteMessage=P;var k=class{constructor(q,U){this.length=q,this.fields=U,this.name="dataRow",this.fieldCount=U.length}};b(k,"DataRowMessage");var M=k;t.DataRowMessage=M;var j=class{constructor(q,U){this.length=q,this.message=U,this.name="notice"}};b(j,"NoticeMessage");var G=j;t.NoticeMessage=G}),NM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=se.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=se.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=se.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),s}};b(e,"Writer");var r=e;t.Writer=r}),RM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=NM(),r=new e.Writer,n=b(q=>{r.addInt16(3).addInt16(0);for(let te of Object.keys(q))r.addCString(te).addCString(q[te]);r.addCString("client_encoding").addCString("UTF8");var U=r.addCString("").flush(),J=U.length+4;return new e.Writer().addInt32(J).add(U).flush()},"startup"),i=b(()=>{let q=se.allocUnsafe(8);return q.writeInt32BE(8,0),q.writeInt32BE(80877103,4),q},"requestSsl"),s=b(q=>r.addCString(q).flush(112),"password"),a=b(function(q,U){return r.addCString(q).addInt32(se.byteLength(U)).addString(U),r.flush(112)},"sendSASLInitialResponseMessage"),o=b(function(q){return r.addString(q).flush(112)},"sendSCRAMClientFinalMessage"),c=b(q=>r.addCString(q).flush(81),"query"),u=[],l=b(q=>{let U=q.name||"";U.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",U,U.length),console.error("This can cause conflicts and silent errors executing queries"));let J=q.types||u;for(var te=J.length,fe=r.addCString(U).addCString(q.text).addInt16(te),he=0;he<te;he++)fe.addInt32(J[he]);return r.flush(80)},"parse"),f=new e.Writer,d=b(function(q,U){for(let J=0;J<q.length;J++){let te=U?U(q[J],J):q[J];te==null?(r.addInt16(0),f.addInt32(-1)):te instanceof se?(r.addInt16(1),f.addInt32(te.length),f.add(te)):(r.addInt16(0),f.addInt32(se.byteLength(te)),f.addString(te))}},"writeValues"),v=b((q={})=>{let U=q.portal||"",J=q.statement||"",te=q.binary||!1,fe=q.values||u,he=fe.length;return r.addCString(U).addCString(J),r.addInt16(he),d(fe,q.valueMapper),r.addInt16(he),r.add(f.flush()),r.addInt16(te?1:0),r.flush(66)},"bind"),m=se.from([69,0,0,0,9,0,0,0,0,0]),p=b(q=>{if(!q||!q.portal&&!q.rows)return m;let U=q.portal||"",J=q.rows||0,te=se.byteLength(U),fe=4+te+1+4,he=se.allocUnsafe(1+fe);return he[0]=69,he.writeInt32BE(fe,1),he.write(U,5,"utf-8"),he[te+5]=0,he.writeUInt32BE(J,he.length-4),he},"execute"),y=b((q,U)=>{let J=se.allocUnsafe(16);return J.writeInt32BE(16,0),J.writeInt16BE(1234,4),J.writeInt16BE(5678,6),J.writeInt32BE(q,8),J.writeInt32BE(U,12),J},"cancel"),w=b((q,U)=>{let J=4+se.byteLength(U)+1,te=se.allocUnsafe(1+J);return te[0]=q,te.writeInt32BE(J,1),te.write(U,5,"utf-8"),te[J]=0,te},"cstringMessage"),S=r.addCString("P").flush(68),_=r.addCString("S").flush(68),N=b(q=>q.name?w(68,`${q.type}${q.name||""}`):q.type==="P"?S:_,"describe"),R=b(q=>{let U=`${q.type}${q.name||""}`;return w(67,U)},"close"),E=b(q=>r.add(q).flush(100),"copyData"),A=b(q=>w(102,q),"copyFail"),P=b(q=>se.from([q,0,0,0,4]),"codeOnlyBuffer"),k=P(72),M=P(83),j=P(88),G=P(99),Q={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:v,execute:p,describe:N,close:R,flush:b(()=>k,"flush"),sync:b(()=>M,"sync"),end:b(()=>j,"end"),copyData:E,copyDone:b(()=>G,"copyDone"),copyFail:A,cancel:y};t.serialize=Q}),LM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};b(r,"BufferReader");var n=r;t.BufferReader=n}),qM=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=PE(),r=LM(),n=1,i=4,s=n+i,a=se.allocUnsafe(0),o=class{constructor(l){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,f){this.mergeBuffer(l);let d=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+s<=d;){let m=this.buffer[v],p=this.buffer.readUInt32BE(v+n),y=n+p;if(y+v<=d){let w=this.handlePacket(v+s,m,p,this.buffer);f(w),v+=y}else break}v===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-v,this.bufferOffset=v)}mergeBuffer(l){if(this.bufferLength>0){let f=this.bufferLength+l.byteLength;if(f+this.bufferOffset>this.buffer.byteLength){let d;if(f<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let v=this.buffer.byteLength*2;for(;f>=v;)v*=2;d=se.allocUnsafe(v)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=f}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,f,d,v){switch(f){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,d,v);case 67:return this.parseCommandCompleteMessage(l,d,v);case 90:return this.parseReadyForQueryMessage(l,d,v);case 65:return this.parseNotificationMessage(l,d,v);case 82:return this.parseAuthenticationResponse(l,d,v);case 83:return this.parseParameterStatusMessage(l,d,v);case 75:return this.parseBackendKeyData(l,d,v);case 69:return this.parseErrorMessage(l,d,v,"error");case 78:return this.parseErrorMessage(l,d,v,"notice");case 84:return this.parseRowDescriptionMessage(l,d,v);case 116:return this.parseParameterDescriptionMessage(l,d,v);case 71:return this.parseCopyInMessage(l,d,v);case 72:return this.parseCopyOutMessage(l,d,v);case 100:return this.parseCopyData(l,d,v);default:return new e.DatabaseError("received invalid response: "+f.toString(16),d,"error")}}parseReadyForQueryMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.string(1);return new e.ReadyForQueryMessage(f,v)}parseCommandCompleteMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring();return new e.CommandCompleteMessage(f,v)}parseCopyData(l,f,d){let v=d.slice(l,l+(f-4));return new e.CopyDataMessage(f,v)}parseCopyInMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyInResponse")}parseCopyOutMessage(l,f,d){return this.parseCopyMessage(l,f,d,"copyOutResponse")}parseCopyMessage(l,f,d,v){this.reader.setBuffer(l,d);let m=this.reader.byte()!==0,p=this.reader.int16(),y=new e.CopyResponse(f,v,m,p);for(let w=0;w<p;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.cstring(),p=this.reader.cstring();return new e.NotificationResponseMessage(f,v,m,p)}parseRowDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.RowDescriptionMessage(f,v);for(let p=0;p<v;p++)m.fields[p]=this.parseField();return m}parseField(){let l=this.reader.cstring(),f=this.reader.int32(),d=this.reader.int16(),v=this.reader.int32(),m=this.reader.int16(),p=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,f,d,v,m,p,y)}parseParameterDescriptionMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new e.ParameterDescriptionMessage(f,v);for(let p=0;p<v;p++)m.dataTypeIDs[p]=this.reader.int32();return m}parseDataRowMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int16(),m=new Array(v);for(let p=0;p<v;p++){let y=this.reader.int32();m[p]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,m)}parseParameterStatusMessage(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(f,v,m)}parseBackendKeyData(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(f,v,m)}parseAuthenticationResponse(l,f,d){this.reader.setBuffer(l,d);let v=this.reader.int32(),m={name:"authenticationOk",length:f};switch(v){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let p;do p=this.reader.cstring(),p&&m.mechanisms.push(p);while(p);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(f-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return m}parseErrorMessage(l,f,d,v){this.reader.setBuffer(l,d);let m={},p=this.reader.string(1);for(;p!=="\0";)m[p]=this.reader.cstring(),p=this.reader.string(1);let y=m.M,w=v==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,v);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};b(o,"Parser");var c=o;t.Parser=c}),IE=pe(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=PE();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=RM();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=qM();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}b(i,"parse"),t.parse=i}),OE={};pr(OE,{connect:()=>NE});function NE({socket:t,servername:e}){return t.startTls(e),t}var MM=jt(()=>{"use strict";ee(),b(NE,"connect")}),RE=pe((t,e)=>{"use strict";ee();var r=(Zh(),ot(TE)),n=ai().EventEmitter,{parse:i,serialize:s}=IE(),a=s.flush(),o=s.sync(),c=s.end(),u=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(m){m==="message"&&(v._emitMessage=!0)})}connect(d,v){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,v),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let p=b(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",p),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(MM(),ot(OE));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(v)===0&&(_.servername=v);try{m.stream=S.connect(_)}catch(N){return m.emit("error",N)}m.attachListeners(m.stream),m.stream.on("error",p),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,v=>{var m=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(m,v)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,v){this._send(s.cancel(d,v))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,v){this._send(s.sendSASLInitialResponseMessage(d,v))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};b(u,"Connection");var l=u;e.exports=l}),jM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=SM(),a=TM(),o=Hh(),c=Kh(),u=OM(),l=Lu(),f=RE(),d=class extends r{constructor(p){super(),this.connectionParameters=new c(p),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=p||{};this._Promise=y.Promise||Ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(p){let y=b(w=>{le.nextTick(()=>{w.handleError(p,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(p){var y=this,w=this.connection;if(this._connectionCallback=p,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{p(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(p){if(p){this._connect(p);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(p){p.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),p.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),p.on("authenticationSASL",this._handleAuthSASL.bind(this)),p.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),p.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),p.on("backendKeyData",this._handleBackendKeyData.bind(this)),p.on("error",this._handleErrorEvent.bind(this)),p.on("errorMessage",this._handleErrorMessage.bind(this)),p.on("readyForQuery",this._handleReadyForQuery.bind(this)),p.on("notice",this._handleNotice.bind(this)),p.on("rowDescription",this._handleRowDescription.bind(this)),p.on("dataRow",this._handleDataRow.bind(this)),p.on("portalSuspended",this._handlePortalSuspended.bind(this)),p.on("emptyQuery",this._handleEmptyQuery.bind(this)),p.on("commandComplete",this._handleCommandComplete.bind(this)),p.on("parseComplete",this._handleParseComplete.bind(this)),p.on("copyInResponse",this._handleCopyInResponse.bind(this)),p.on("copyData",this._handleCopyData.bind(this)),p.on("notification",this._handleNotification.bind(this))}_checkPgPass(p){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;p()}).catch(w=>{y.emit("error",w)}):this.password!==null?p():a(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),p()})}_handleAuthCleartextPassword(p){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(p){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,p.salt);this.connection.password(y)})}_handleAuthSASL(p){this._checkPgPass(()=>{this.saslSession=s.startSession(p.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(p){s.continueSession(this.saslSession,this.password,p.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(p){s.finalizeSession(this.saslSession,p.data),this.saslSession=null}_handleBackendKeyData(p){this.processID=p.processID,this.secretKey=p.secretKey}_handleReadyForQuery(p){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(p){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(p);this.emit("error",p)}}_handleErrorEvent(p){if(this._connecting)return this._handleErrorWhileConnecting(p);this._queryable=!1,this._errorAllQueries(p),this.emit("error",p)}_handleErrorMessage(p){if(this._connecting)return this._handleErrorWhileConnecting(p);let y=this.activeQuery;if(!y){this._handleErrorEvent(p);return}this.activeQuery=null,y.handleError(p,this.connection)}_handleRowDescription(p){this.activeQuery.handleRowDescription(p)}_handleDataRow(p){this.activeQuery.handleDataRow(p)}_handlePortalSuspended(p){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(p){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(p){this.activeQuery.handleCommandComplete(p,this.connection)}_handleParseComplete(p){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(p){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(p){this.activeQuery.handleCopyData(p,this.connection)}_handleNotification(p){this.emit("notification",p)}_handleNotice(p){this.emit("notice",p)}getStartupConf(){var p=this.connectionParameters,y={user:p.user,database:p.database},w=p.application_name||p.fallback_application_name;return w&&(y.application_name=w),p.replication&&(y.replication=""+p.replication),p.statement_timeout&&(y.statement_timeout=String(parseInt(p.statement_timeout,10))),p.lock_timeout&&(y.lock_timeout=String(parseInt(p.lock_timeout,10))),p.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(p.idle_in_transaction_session_timeout,10))),p.options&&(y.options=p.options),y}cancel(p,y){if(p.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(p.processID,p.secretKey)})}else p.queryQueue.indexOf(y)!==-1&&p.queryQueue.splice(p.queryQueue.indexOf(y),1)}setTypeParser(p,y,w){return this._types.setTypeParser(p,y,w)}getTypeParser(p,y){return this._types.getTypeParser(p,y)}escapeIdentifier(p){return'"'+p.replace(/"/g,'""')+'"'}escapeLiteral(p){for(var y=!1,w="'",S=0;S<p.length;S++){var _=p[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let p=this.activeQuery.submit(this.connection);p&&le.nextTick(()=>{this.activeQuery.handleError(p,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(p,y,w){var S,_,N,R,E;if(p==null)throw new TypeError("Client was passed a null or undefined query");return typeof p.submit=="function"?(N=p.query_timeout||this.connectionParameters.query_timeout,_=S=p,typeof y=="function"&&(S.callback=S.callback||y)):(N=this.connectionParameters.query_timeout,S=new u(p,y,w),S.callback||(_=new this._Promise((A,P)=>{S.callback=(k,M)=>k?P(k):A(M)}))),N&&(E=S.callback,R=setTimeout(()=>{var A=new Error("Query read timeout");le.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var P=this.queryQueue.indexOf(S);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},N),S.callback=(A,P)=>{clearTimeout(R),E(A,P)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(p){if(this._ending=!0,!this.connection._connecting)if(p)p();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),p)this.connection.once("end",p);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(d,"Client");var v=d;v.Query=u,e.exports=v}),DM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=b(function(){},"NOOP"),i=b((m,p)=>{let y=m.findIndex(p);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),s=class{constructor(p,y,w){this.client=p,this.idleListener=y,this.timeoutId=w}};b(s,"IdleItem");var a=s,o=class{constructor(p){this.callback=p}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(m,p){if(p)return{callback:p,result:void 0};let y,w,S=b(function(N,R){N?y(N):w(R)},"cb"),_=new m(function(N,R){w=N,y=R}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:S,result:_}}b(l,"promisify");function f(m,p){return b(function y(w){w.client=p,p.removeListener("error",y),p.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(p),m.emit("error",w,p)},"idleListener")}b(f,"makeIdleListener");var d=class extends r{constructor(p,y){super(),this.options=Object.assign({},p),p!=null&&"password"in p&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),p!=null&&p.ssl&&p.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Jh().Client,this.Promise=this.options.Promise||Ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let p=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,p,S,!1)}if(!this._isFull())return this.newClient(p);throw new Error("unexpected condition")}_remove(p){let y=i(this._idle,w=>w.client===p);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==p),p.end(),this.emit("remove",p)}connect(p){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return p?p(S):this.Promise.reject(S)}let y=l(this.Promise,p),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((R,E,A)=>{clearTimeout(N),y.callback(R,E,A)},"queueCallback"),_=new c(S),N=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(p){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(N=>{if(S&&clearTimeout(S),y.on("error",w),N)this.log("client failed to connect",N),this._clients=this._clients.filter(R=>R!==y),_&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),p.timedOut||p.callback(N,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,A,P)=>P()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,p,w,!0)}})}_acquireClient(p,y,w,S){S&&this.emit("connect",p),this.emit("acquire",p),p.release=this._releaseOnce(p,w),p.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(p,p.release):p.release():S&&this.options.verify?this.options.verify(p,_=>{if(_)return p.release(_),y.callback(_,void 0,n);y.callback(void 0,p,p.release)}):y.callback(void 0,p,p.release)}_releaseOnce(p,y){let w=!1;return S=>{w&&u(),w=!0,this._release(p,y,S)}}_release(p,y,w){if(p.on("error",y),p._poolUseCount=(p._poolUseCount||0)+1,this.emit("release",w,p),w||this.ending||!p._queryable||p._ending||p._poolUseCount>=this.options.maxUses){p._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(p),this._pulseQueue();return}if(this._expired.has(p)){this.log("remove expired client"),this._expired.delete(p),this._remove(p),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(p)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&p.unref(),this._idle.push(new a(p,y,S)),this._pulseQueue()}query(p,y,w){if(typeof p=="function"){let _=l(this.Promise,p);return $h(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,N)=>{if(_)return w(_);let R=!1,E=b(A=>{R||(R=!0,N.release(A),w(A))},"onError");N.once("error",E),this.log("dispatching query");try{N.query(p,y,(A,P)=>{if(this.log("query dispatched"),N.removeListener("error",E),!R)return R=!0,N.release(A),A?w(A):w(void 0,P)})}catch(A){return N.release(A),w(A)}}),S.result}end(p){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return p?p(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,p);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((p,y)=>p+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(d,"Pool");var v=d;e.exports=v}),LE={};pr(LE,{default:()=>qE});var qE,BM=jt(()=>{"use strict";ee(),qE={}}),FM=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),UM=pe((t,e)=>{"use strict";ee();var r=ai().EventEmitter,n=(Nu(),ot(so)),i=qu(),s=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=a[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(d,v,m){if(o.native.arrayMode=!1,$h(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?v.forEach((p,y)=>{p.forEach(w=>{c.emit("row",w,m[y])})}):v.forEach(function(p){c.emit("row",p,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(d)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(d){return d?u(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return u(d)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),$M=pe((t,e)=>{"use strict";ee();var r=(BM(),ot(LE)),n=Hh(),i=FM(),s=ai().EventEmitter,a=(Nu(),ot(so)),o=Kh(),c=UM(),u=e.exports=function(l){s.call(this),l=l||{},this._Promise=l.Promise||Ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,a.inherits(u,s),u.prototype._errorAllQueries=function(l){let f=b(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,v){if(d)return l(d);f.native.connect(v,function(m){if(m)return f.native.end(),l(m);f._connected=!0,f.native.on("error",function(p){f._queryable=!1,f._errorAllQueries(p),f.emit("error",p)}),f.native.on("notification",function(p){f.emit("notification",{channel:p.relname,payload:p.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,d)=>{this._connect(v=>{v?d(v):f()})})},u.prototype.query=function(l,f,d){var v,m,p,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")p=l.query_timeout||this.connectionParameters.query_timeout,m=v=l,typeof f=="function"&&(l.callback=f);else if(p=this.connectionParameters.query_timeout,v=new c(l,f,d),!v.callback){let S,_;m=new this._Promise((N,R)=>{S=N,_=R}),v.callback=(N,R)=>N?_(N):S(R)}return p&&(w=v.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{v.handleError(S,this.connection)}),w(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},p),v.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(v),this._pulseQueryQueue(),m):(v.native=this.native,le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var d;return l||(d=new this._Promise(function(v,m){l=b(p=>p?m(p):v(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),d},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var d=this;f.once("_done",function(){d._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,d){return this._types.setTypeParser(l,f,d)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),iE=pe((t,e)=>{"use strict";ee(),e.exports=$M()}),Jh=pe((t,e)=>{"use strict";ee();var r=jM(),n=Lu(),i=RE(),s=DM(),{DatabaseError:a}=IE(),o=b(u=>{var l;return l=class extends s{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Ru(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(iE()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(iE())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var ME=gs(Jh());Zh();ee();Zh();CE();var zM=gs(qu()),QM=gs(Hh());function jE(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(jE,"encodeBuffersAsBytea");var DE=class BE extends Error{constructor(e){super(e),ae(this,"name","NeonDbError"),ae(this,"severity"),ae(this,"code"),ae(this,"detail"),ae(this,"hint"),ae(this,"position"),ae(this,"internalPosition"),ae(this,"internalQuery"),ae(this,"where"),ae(this,"schema"),ae(this,"table"),ae(this,"column"),ae(this,"dataType"),ae(this,"constraint"),ae(this,"file"),ae(this,"line"),ae(this,"routine"),ae(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,BE)}};b(DE,"NeonDbError");var ms=DE,sE="transaction() expects an array of queries, or a function returning an array of queries",GM=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function FE(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Wh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:d,hostname:v,port:m,pathname:p}=l;if(f!=="postgres:"&&f!=="postgresql:"||!d||!v||!p)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let N,R;if(typeof S=="string")N=S,R=_[1],_=_[0]??[];else{N="";for(let A=0;A<S.length;A++)N+=S[A],A<_.length&&(N+="$"+(A+1))}_=_.map(A=>jE((0,zM.prepareValue)(A)));let E={query:N,params:_};return o&&o(E),UE(w,E,R)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(sE);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(sE)});let N=S.map(E=>E.parameterizedQuery),R=S.map(E=>E.opts??{});return w(N,R,_)};async function w(S,_,N){let{fetchEndpoint:R,fetchFunction:E}=mn,A=Array.isArray(S)?{queries:S}:S,P=n??{},k=e??!1,M=r??!1,j=i,G=s,Q=a;N!==void 0&&(N.fetchOptions!==void 0&&(P={...P,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(M=N.fullResults),N.isolationLevel!==void 0&&(j=N.isolationLevel),N.readOnly!==void 0&&(G=N.readOnly),N.deferrable!==void 0&&(Q=N.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(P={...P,..._.fetchOptions});let q=u;!Array.isArray(_)&&_?.authToken!==void 0&&(q=_.authToken);let U=typeof R=="function"?R(v,m,{jwtAuth:q!==void 0}):R,J={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await $E(q);te&&(J.Authorization=`Bearer ${te}`),Array.isArray(S)&&(j!==void 0&&(J["Neon-Batch-Isolation-Level"]=j),G!==void 0&&(J["Neon-Batch-Read-Only"]=String(G)),Q!==void 0&&(J["Neon-Batch-Deferrable"]=String(Q)));let fe;try{fe=await(E??fetch)(U,{method:"POST",body:JSON.stringify(A),headers:J,...P})}catch(he){let Le=new ms(`Error connecting to database: ${he.message}`);throw Le.sourceError=he,Le}if(fe.ok){let he=await fe.json();if(Array.isArray(S)){let Le=he.results;if(!Array.isArray(Le))throw new ms("Neon internal error: unexpected result format");return Le.map((Ce,Z)=>{let ge=_[Z]??{},pt=ge.arrayMode??k,ft=ge.fullResults??M;return Uh(Ce,{arrayMode:pt,fullResults:ft,parameterizedQuery:S[Z],resultCallback:c,types:ge.types})})}else{let Le=_??{},Ce=Le.arrayMode??k,Z=Le.fullResults??M;return Uh(he,{arrayMode:Ce,fullResults:Z,parameterizedQuery:S,resultCallback:c,types:Le.types})}}else{let{status:he}=fe;if(he===400){let Le=await fe.json(),Ce=new ms(Le.message);for(let Z of GM)Ce[Z]=Le[Z]??void 0;throw Ce}else{let Le=await fe.text();throw new ms(`Server error (HTTP status ${he}): ${Le}`)}}}return b(w,"execute"),y}b(FE,"neon");function UE(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(UE,"createNeonQueryPromise");function Uh(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new QM.default(s),o=t.fields.map(l=>l.name),c=t.fields.map(l=>a.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,d)=>f===null?null:c[d](f))):t.rows.map(l=>Object.fromEntries(l.map((f,d)=>[o[d],f===null?null:c[d](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=a,t):u}b(Uh,"processQueryResult");async function $E(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new ms("Error getting auth token.");throw e instanceof Error&&(r=new ms(`Error getting auth token: ${e.message}`)),r}}b($E,"getAuthToken");var VM=gs(Kh()),ys=gs(Jh()),zE=class extends ME.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=thinpm warn config production Use `--omit=dev` instead.
2025-11-30T04:45:03.282507925Z [inf]  
2025-11-30T04:45:03.282512014Z [inf]  > rest-express@1.0.0 start
2025-11-30T04:45:03.282515916Z [inf]  > NODE_ENV=production node dist/index.cjs
2025-11-30T04:45:03.282520899Z [inf]  
2025-11-30T04:45:03.969733285Z [err]  Warning: connect.session() MemoryStore is not
2025-11-30T04:45:03.969737912Z [err]  designed for a production environment, as it will leak
2025-11-30T04:45:03.969742305Z [err]  memory, and will not scale past a single process.
2025-11-30T04:45:03.969747197Z [err]  /app/dist/index.cjs:85