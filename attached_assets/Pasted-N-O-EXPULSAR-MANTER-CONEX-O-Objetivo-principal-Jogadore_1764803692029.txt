NÃƒO EXPULSAR, MANTER CONEXÃƒO

â— Objetivo principal: Jogadores NÃƒO devem ser expulsos quando inativos.
O sistema deve manter a conexÃ£o viva e sincronizada mesmo com o usuÃ¡rio parado, aba minimizada, celular bloqueado ou open-inativo.

Quero que vocÃª implemente um sistema que mantenha clientes conectados ao servidor e impeÃ§a o estado ghost, sem remover automaticamente ninguÃ©m.

ğŸ“Œ FunÃ§Ãµes obrigatÃ³rias
1. Heartbeat para manter conexÃ£o viva

Servidor envia ping periodicamente somente para confirmar vida do socket

Cliente responde com pong

Se o ping falhar, o cliente deve reconectar, nÃ£o ser expulso

NÃ£o delete o jogador ao perder heartbeat.
Se o server nÃ£o receber pong, marque como desconectado temporÃ¡rio e aguarde reconexÃ£o.

2. ReconexÃ£o automÃ¡tica do cliente

Detectou onclose? -> reconectar mantendo ID da sessÃ£o

Reconectou? -> enviar sync_request para atualizar estado no lobby

Nenhuma desconexÃ£o deve resultar em kick automÃ¡tico.

3. SincronizaÃ§Ã£o ao voltar foco

Quando aba voltar ao foco â†’ sync_request

Servidor responde com estado atual do lobby e forÃ§a re-render client-side

Isso corrige jogadores invisÃ­veis sem remover ninguÃ©m.

4. Anti-Ghost sem expulsar

Se o cliente cair e reconectar â†’ ele deve voltar com o mesmo ID

Se o socket cair, mas o cliente continuar com a aba aberta â†’ reconexÃ£o corrige isso

O jogador sÃ³ some do lobby se ele de fato sair manualmente

5. ValidaÃ§Ã£o para iniciar partida

O host sÃ³ inicia o jogo com jogadores sincronizados, nÃ£o expulsos.

Exemplo:

const activePlayers = players.filter(p => p.connected === true); 
// NÃƒO expulsar players desconectados â€“ apenas marcar estado e aguardar reconexÃ£o

Resumo para evitar erro
â— NÃƒO QUERO timeout expulsando players
â— NÃƒO QUERO remover quem ficar inativo
âœ” QUERO reconexÃ£o automÃ¡tica
âœ” QUERO que ninguÃ©m vire ghost
âœ” QUERO sync do lobby ao focar janela
âœ” QUERO o jogador preso na sala mesmo AFK
Gere agora o cÃ³digo completo seguindo exatamente essas regras.

Se tentar remover players por timeout â†’ estarÃ¡ errado.